/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(exports){layui.use(["jquery","form","admin","setter"],function(){function getGroups(){$(".left").empty(),$(".right").empty(),$.ajax({url:baseUrl+"/goodAddress",type:"get",headers:headers,beforeSend:function(){loading=layer.load(loadType,loadShade)},success:function(res){if("string"==typeof res&&(res=eval("("+res+")")),layer.close(loading),"1"!==res.status)return layer.msg(res.info),!1;for(var data=res.districts[0].districts,length=data.length,i=0;i<length;i++)$(".left").append('<div class="areaAll"><span class="allArea">'+data[i].name+'</span>><span class="areaChoice">选择></span></div>');form.render()},error:function(){layer.msg(errorMsg),layer.close(loading)}})}var $=layui.$,form=layui.form,admin=layui.admin,setter=layui.setter,baseUrl=setter.baseUrl,sucMsg=setter.successMsg,errorMsg=setter.errorMsg,timeOutCode=setter.timeOutCode,timeOutMsg=setter.timeOutMsg,headers={"Access-Token":layui.data(setter.tableName).access_token},openIndex,loading,loadType=1,loadShade={shade:.3},successMsg,saa_key=sessionStorage.getItem("saa_key"),ajaxType,expressId=sessionStorage.getItem("expressId"),isAreaEdit=0;form.render(),getGroups();var url=baseUrl+"/merchantShopExpressTemplate",key="?key="+saa_key,choiceArea=[];$(document).off("click",".add_new").on("click",".add_new",function(){$(".right").empty(),$(".allArea").each(function(){$(this).parent().show()}),$("input[name='app_id']:eq(0)").prop("checked",!0),form.render(),choiceArea=[],openIndex=layer.open({type:1,title:"新增",content:$("#area_form"),shade:0,offset:"100px",area:["50vw","60vh"]})}),$(document).off("click",".areaChoice").on("click",".areaChoice",function(){var e=$(this).prev()[0].innerText;choiceArea.push(e),$(".right").append('<div class="deleteArea"><span>'+e+'</span><span class="areaDelete">删除></span>></div>'),$(this).parent().hide()}),$(document).on("click",".areaDelete",function(){var e=$(this).prev()[0].innerText;$(".allArea").each(function(a,n){n.innerText==e&&$(n).parent().show()});var a=choiceArea.indexOf(e);a>-1&&choiceArea.splice(a,1),$(this).parent().remove()});var expressEdit="";form.on("submit(areaSub)",function(){layer.close(openIndex);var e="";choiceArea===!1&&choiceArea.push("全国统一运费");for(var a=0;a<choiceArea.length;a++)e+=choiceArea[a]+"、";if(e=e.substr(0,e.length-1),isAreaEdit){var n=expressEdit.parent()[0].childNodes;n[0].innerText=e,n[1].defaultValue=e}else $("#add_new").before("<tr>\n    <td><span>"+e+'</span><input name="names" value="'+e+'" style="display: none"><span class="edit">编辑</span><span class="delete">删除</span></td>\n    <td><input name="first_num" class="layui-input"></td>\n    <td><input name="first_price" class="layui-input"></td>\n    <td><input name="expand_num" class="layui-input"></td>\n    <td><input name="expand_price" class="layui-input"></td>\n</tr>');form.render()}),$(document).off("click",".edit").on("click",".edit",function(){expressEdit=$(this),isAreaEdit=1;var e=$(this).prev()[0].defaultValue,a=e.split("、");$(".right").empty(),$(".allArea").each(function(){$(this).parent().show()}),$(".allArea").each(function(){var e=this.innerText;$.inArray(e,a)!==-1&&($(".right").append("<div><span>"+e+'</span><span class="areaDelete">删除></span>></div>'),$(this).parent().hide())}),form.render(),openIndex=layer.open({type:1,title:"新增",content:$("#area_form"),shade:0,offset:"100px",area:["50vw","60vh"]})}),$(document).on("click",".delete",function(){$(this).parent().parent().remove()}),expressId&&$.ajax({url:url+"/"+expressId+key,type:"get",headers:headers,beforeSend:function(){loading=layer.load(loadType,loadShade)},success:function(e){if(e.status==timeOutCode)return layer.msg(timeOutMsg),admin.exit(),!1;if(layer.close(loading),200!=e.status)return layer.msg(e.message),!1;$("input[name=name]").val(e.data.name),$("input[name='type'][value='"+e.data.type+"']").prop("checked",!0),$(".expressTitle").parent().remove();for(var a=e.data.details.app,n=a.length,s=0;s<n;s++)"全国统一运费"===a[s].names?$("#add_new").before("<tr>\n    <td><span>"+a[s].names+'</span><input name="names" value="'+a[s].names+'" style="display: none;"></td>\n    <td><input name="first_num" value="'+a[s].first_num+'" class="layui-input"></td>\n    <td><input name="first_price" value="'+a[s].first_price+'" class="layui-input"></td>\n    <td><input name="expand_num" value="'+a[s].expand_num+'" class="layui-input"></td>\n    <td><input name="expand_price" value="'+a[s].expand_price+'" class="layui-input"></td>\n</tr>'):$("#add_new").before('<tr>\n    <td><span class="one">'+a[s].names+'</span><input name="names" value="'+a[s].names+'" style="display: none;"><span class="edit">编辑</span><span class="delete">删除</span></td>\n    <td><input name="first_num" value="'+a[s].first_num+'" class="layui-input"></td>\n    <td><input name="first_price" value="'+a[s].first_price+'" class="layui-input"></td>\n    <td><input name="expand_num" value="'+a[s].expand_num+'" class="layui-input"></td>\n    <td><input name="expand_price" value="'+a[s].expand_price+'" class="layui-input"></td>\n</tr>');form.render()},error:function(){layer.msg(errorMsg),layer.close(loading)}}),form.on("submit(sub)",function(){var e,a=[],n=[],s=[],t=[],r=[],i=url;expressId?(ajaxType="put",i=url+"/"+expressId,successMsg=sucMsg.put):(ajaxType="post",successMsg=sucMsg.post),$("input[name='names']").each(function(e,n){a.push(n.value)}),$("input[name='first_num']").each(function(e,a){n.push(a.value)}),$("input[name='first_price']").each(function(e,a){s.push(a.value)}),$("input[name='expand_num']").each(function(e,a){t.push(a.value)}),$("input[name='expand_price']").each(function(e,a){r.push(a.value)}),e={name:$("input[name=name]").val(),type:$("input[name='type']:checked").val(),names:a,first_num:n,first_price:s,expand_num:t,expand_price:r,key:saa_key},$.ajax({url:i,data:e,type:ajaxType,async:!1,headers:headers,beforeSend:function(){loading=layer.load(loadType,loadShade)},success:function(e){return e.status==timeOutCode?(layer.msg(timeOutMsg),admin.exit(),!1):(layer.close(loading),200!=e.status?(layer.msg(e.message),!1):(layer.msg(successMsg),layer.close(openIndex),location.hash="/logistics/express"))},error:function(){layer.msg(errorMsg),layer.close(loading)}})})}),exports("logistics/add",{})});