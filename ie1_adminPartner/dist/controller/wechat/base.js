/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(e){layui.use(["jquery","form","admin","setter"],function(){function e(e){var a={token:h,aes:x,type:e,key:p,config_type:"docking"};r.ajax({url:w,type:"put",data:a,async:!1,headers:g,beforeSend:function(){n=layer.load(y,f)},success:function(e){return layer.close(n),e.status==d?(layer.msg(m),i.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(h=e.data.token,x=e.data.aes,r("input[name=url]").val(e.data.url),r(".url").text(e.data.url),r("input[name=token]").val(h),r(".token").text(h),r("input[name=aes]").val(x),r(".aes").text(x),k=1,void s.render())},error:function(){layer.msg(c),layer.close(n)}})}function a(){r.ajax({url:w+"?key="+p+"&config_type=docking",type:"get",async:!1,headers:g,beforeSend:function(){n=layer.load(y,f)},success:function(e){return layer.close(n),e.status==d?(layer.msg(m),i.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(h=e.data.token,x=e.data.aes,r("input[name=url]").val(e.data.url),r(".url").text(e.data.url),r("input[name=token]").val(h),r(".token").text(h),r("input[name=aes]").val(x),r(".aes").text(x),void(k=1))},error:function(){layer.msg(c),layer.close(n)}})}var t,n,r=layui.$,s=layui.form,i=layui.admin,o=layui.setter,l=o.baseUrl,u=o.successMsg,c=o.errorMsg,d=o.timeOutCode,m=o.timeOutMsg,g={"Access-Token":layui.data(o.tableName).access_token},y=1,f={shade:.3},p=sessionStorage.getItem("saa_key"),v="wechat";s.render();var k=0,h="",x="",I="";r("#addHeadImg").change(function(){var e=this.files[0];if(window.FileReader){var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(e){I=e.target.result,r("#headImg").attr("src",e.target.result)}}e=null});var _="";r("#addQrCodeImg").change(function(){var e=this.files[0];if(window.FileReader){var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(e){_=e.target.result,r("#qrCodeImg").attr("src",e.target.result)}}e=null});var b=l+"/merchantConfig?key="+p+"&config_type="+v,w=l+"/merchantConfig";r.ajax({url:b,type:"get",async:!1,headers:g,beforeSend:function(){n=layer.load(y,f)},success:function(e){return layer.close(n),e.status==d?(layer.msg(m),i.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(r("input[name=name]").val(e.data.name),r("input[name=account]").val(e.data.account),r("select[name=type]").val(e.data.type),r("textarea[name=describe]").val(e.data.describe),r("input[name=initialID]").val(e.data.initialID),r("input[name=AppID]").val(e.data.AppID),r("input[name=AppSecret]").val(e.data.AppSecret),r("#headImg").attr("src",l+"/"+e.data.headImg),r("#qrCodeImg").attr("src",l+"/"+e.data.qrCodeImg),r("input[name=url]").val(e.data.url),r(".url").text(e.data.url),r("input[name=token]").val(e.data.token),r(".token").text(e.data.token),r("input[name=aes]").val(e.data.aes),r(".aes").text(e.data.aes),void s.render())},error:function(){layer.msg(c),layer.close(n)}}),s.on("submit(next)",function(){r(".second_page").show(),r(".first_page").hide(),k||a()}),s.on("submit(previous)",function(){r(".second_page").hide(),r(".first_page").show()}),r(document).off("click",".regenerate_token").on("click",".regenerate_token",function(){e("token")}),r(document).off("click",".regenerate_aes").on("click",".regenerate_aes",function(){e("aes")}),r(document).on("click",".copy",function(){var e=r(this).prev().prev()[0].value;getCopy(e),layer.msg("复制成功",{icon:1,time:2e3})}),s.on("submit(sub)",function(e){var a={name:e.field.name,account:e.field.account,type:e.field.type,describe:e.field.describe,initialID:e.field.initialID,AppID:e.field.AppID,AppSecret:e.field.AppSecret,headImg:I,qrCodeImg:_,config_type:v,key:p};r.ajax({url:b,type:"put",async:!1,data:a,headers:g,beforeSend:function(){n=layer.load(y,f)},success:function(e){return layer.close(n),e.status==d?(layer.msg(m),i.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void layer.msg(u.put,{icon:1,time:2e3},function(){layer.close(t),r(".second_page").hide(),r(".first_page").show()})},error:function(){layer.msg(c),layer.close(n)}})})}),e("wechat/base",{})});