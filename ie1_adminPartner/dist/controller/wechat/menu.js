/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;function allowDrop(e){e.preventDefault()}function drag(e,n){srcdiv=n,temp=n.innerHTML}function drop(e,n){return e.preventDefault(),srcdiv!=n&&(srcdiv.innerHTML=n.innerHTML,n.innerHTML=temp,$("input[name=name]").val($($(n).find(".menu_name")[0]).text()),click_menu=n),!1}function allowDropChild(e){e.preventDefault()}function dragChild(e,n){srcdivChild=n,tempChild=n.innerHTML}function dropChild(e,n){e.preventDefault(),srcdivChild!=n&&(srcdivChild.innerHTML=n.innerHTML,n.innerHTML=tempChild,$("input[name=name]").val($($(n).find(".menu_name")[0]).text()),click_menu=n)}function addAdd(){return'<li class="pre_menu_item add_add">\n<div>\n<a href="javascript: void(0)" class="pre_menu_link">\n<span class="sub_pre_menu_inner"><i class="icon14_menu_add"></i></span>\n</a>\n</div>\n</li>'}function addChildAdd(){return'<li class="add_menu_child add_child_add">\n<a href="javascript: void(0)" title="最多添加5个子菜单">\n<span class="sub_pre_menu_inner">\n<i class="icon14_menu_add"></i>\n</span>\n</a>\n</li>'}function addMenu(e){return e||(e=menu_name),'<li class="pre_menu_item main_menu" ondrop="drop(event,this)" ondragover="allowDrop(event)" draggable="true" ondragstart="drag(event, this)">\n<span class="save_value" style="display: none;"></span>\n<div class="menu_item_div">\n<a href="javascript: void(0)" class="pre_menu_link a_menu">\n<span class="menu_name">'+e+"</span>\n</a>\n</div>\n</li>"}function addChildMenu(e){return e||(e=child_menu_name),'<li class="child_menu" ondrop="dropChild(event,this)" ondragover="allowDropChild(event)" draggable="true" ondragstart="dragChild(event, this)">\n<span class="save_value" style="display: none;"></span>\n<a href="javascript: void(0)">\n<span class="sub_pre_menu_inner">\n<span class="menu_name">'+e+"</span>\n</span>\n</a>\n</li>"}function addChildFrame(){return'<div class="sub_pre_menu_box">\n<ul class="sub_pre_menu_list"></ul>\n<i class="arrow arrow_out"></i>\n<i class="arrow arrow_in"></i>\n</div>'}function addKeyWordList(e){return'<div class="layui-col-md2 choose_top">\n<span class="key_word_name">'+e+"</span>\n</div>"}var default_a_color="#e7e7eb",a_color="#44b549",menu_name="菜单",child_menu_name="子菜单",click_menu="";layui.define(function(e){layui.use(["jquery","form","admin","setter"],function(){function e(){d(".a_menu").css("border","1px solid "+default_a_color).css("color","#777")}function n(){d(".sub_pre_menu_box").hide()}function a(e){var n={};n.name=d("input[name=name]").val(),""!=Trim(d("input[name=name]").val())&&d(d(click_menu).find(".menu_name")[0]).text(d("input[name=name]").val());var a=d("input[name=menu_content]:checked").val();a&&(n.menu_content=a,"1"==a?n.key=d(".key_word_view").text():"2"==a?n.url=d("input[name=url]").val():"3"==a&&(n.AppID=d("input[name=AppID]").val(),n.page_path=d("input[name=page_path]").val())),d(".key_word_view").text(""),d(d(click_menu).find(".save_value")[0]).text(JSON.stringify(n)),e||d("#form")[0].reset()}function t(e){var n=d(d(e).find(".save_value")[0]).text();if(""!=Trim(n)&&(n=JSON.parse(n),d("input[name=name]").val(n.name),n.menu_content)){var a=n.menu_content;d("input[name=menu_content][value='"+a+"']").prop("checked",!0),d(".content").hide(),d(".content_"+a).show(),"1"==a?d(".key_word_view").text(n.key):"2"==a?d("input[name=url]").val(n.url):"3"==a&&(d("input[name=AppID]").val(n.AppID),d("input[name=page_path]").val(n.page_path))}}var i,r,d=layui.$,s=layui.form,u=layui.admin,l=layui.setter,o=l.baseUrl,m=l.errorMsg,_=l.timeOutCode,c=l.timeOutMsg,p={"Access-Token":layui.data(l.tableName).access_token},h=1,f={shade:.3},v=sessionStorage.getItem("saa_key"),y=o+"/merchantWechatMenu",g="?key="+v;d.ajax({url:y+g,type:"get",async:!1,headers:p,beforeSend:function(){r=layer.load(h,f)},success:function(e){if(layer.close(r),e.status==_)return layer.msg(c),u.exit(),!1;if(200!=e.status)return layer.msg(e.message),!1;var n,a=0;if(e.data.button&&(n=e.data.button,a=n.length),0===a)d(".pre_menu_list").append(addAdd()),d(".main_menu,.add_add").css("width","100%"),d(".bottom").hide();else{d(".right_top").show(),d(".right_text").show();for(var t=0;t<a;t++){d(".pre_menu_list").append(addMenu(n[t].name));var i=n[t].sub_button,l=i.length;if(d(d(".main_menu")[t]).append(addChildFrame()),0===l)d(d(".main_menu")[t]).find(".sub_pre_menu_list").append(addChildAdd());else{5!==l&&d(d(".main_menu")[t]).find(".sub_pre_menu_list").append(addChildAdd());for(var o=0;o<l;o++){d(d(".main_menu")[t]).find(".add_menu_child").before(addChildMenu(i[o].name));var m={};if(m.name=i[o].name,i[o].type){var p=1;"click"==i[o].type?(p=1,m.key=i[o].key):"view"==i[o].type?(p=2,m.url=i[o].url):"miniprogram"==i[o].type&&(p=3,m.AppID=i[o].AppID,m.page_path=i[o].page_path),m.menu_content=p}d(d(d(d(".main_menu")[t]).find(".child_menu")[o]).find(".save_value")[0]).text(JSON.stringify(m))}}if("0"!=t)d(d(".main_menu")[t]).find(".sub_pre_menu_box").hide();else if(d("input[name=name]").val(n[t].name),0===l){var h=1;"click"==n[t].type?(h=1,d(".key_word_view").text(n[t].key)):"view"==n[t].type?(h=2,d("input[name=url]").val(n[t].url)):"miniprogram"==n[t].type&&(h=3,d("input[name=AppID]").val(n[t].AppID),d("input[name=page_path]").val(n[t].page_path)),d("input[name=menu_content][value='"+h+"']").prop("checked",!0)}else d(".right_content").hide();var f={};if(f.name=n[t].name,n[t].type){var v=1;"click"==n[t].type?(v=1,f.key=n[t].key):"view"==n[t].type?(v=2,f.url=n[t].url):"miniprogram"==n[t].type&&(v=3,f.AppID=n[t].AppID,f.page_path=n[t].page_path),d(".content").hide(),d(".content_"+h).show(),f.menu_content=v}d(d(d(".main_menu")[t]).find(".save_value")[0]).text(JSON.stringify(f))}a<3&&d(".pre_menu_list").append(addAdd()),1===a?d(".main_menu,.add_add").css("width","50%"):2===a?d(".main_menu,.add_add").css("width","33.333%"):3===a&&d(".main_menu,.add_add").css("width","33.333%"),d(".pre_menu_list").children(":first").find(".a_menu").css("border","1px solid "+a_color).css("color",a_color),click_menu=d(".pre_menu_list").children(":first")}s.render()},error:function(){layer.msg(m),layer.close(r)}}),d(document).off("click",".add_add").on("click",".add_add",function(){a(),d("#form")[0].reset(),d("input[name=name]").val(menu_name),d(".content").hide(),d(".content_1").show();var t=d(".main_menu").length;e(),n(),d(this).before(addMenu()),d(this).prev().append(addChildFrame()),d(this).prev().find(".sub_pre_menu_list").append(addChildAdd()),d(this).prev().find(".a_menu").css("border","1px solid "+a_color).css("color",a_color),click_menu=d(this).prev()[0],0===t?(d(".right_content").show(),d(".main_menu,.add_add").css("width","50%"),d(".bottom").show()):1===t?(d(".right_content").show(),d(".main_menu,.add_add").css("width","33.333%")):2===t&&(d(".right_content").show(),d(this).remove(),d(".main_menu,.add_add").css("width","33.333%")),d(".menu_name_key").text(menu_name+"名称"),d(".menu_name").attr("placeholder","请输入"+menu_name+"名称"),d(".right_top").show(),d(".right_text").show()}),d(document).off("click",".main_menu").on("click",".main_menu",function(){a(),t(this),e(),n(),d(this).find(".sub_pre_menu_box").show(),d(this).find(".a_menu").css("border","1px solid "+a_color).css("color",a_color);var i=d(this).find(".child_menu").length;return 0===i?d(".right_content").show():d(".right_content").hide(),s.render(),click_menu=this,!1}),d(document).off("click",".add_child_add").on("click",".add_child_add",function(){a(),d("#form")[0].reset(),d(".content").hide(),d(".content_1").show(),d("input[name=name]").val(child_menu_name),d(this).parent().prepend(addChildMenu(child_menu_name)),click_menu=d(this).parent().children(":first")[0];var e=d(this).parent().find("li").length;return 6===e&&d(this).remove(),!1}),d(document).off("click",".child_menu").on("click",".child_menu",function(){return a(),t(this),d(".right_content").show(),s.render(),click_menu=this,!1}),s.on("radio(radio)",function(e){d(".content").hide(),d(".content_"+e.value).show()}),d("input[name=name]").change(function(){""!=Trim(d("input[name=name]").val())&&d(d(click_menu).find(".menu_name")[0]).text(d("input[name=name]").val())}),d(document).off("click",".delete_menu").on("click",".delete_menu",function(){var e=click_menu,n=d(click_menu).attr("class");if(d("#form")[0].reset(),"child_menu"===n){var a=d(e).parent().find(".child_menu").length,i=d(d(d(e).parents(".main_menu")[0]).find(".menu_name")[0]).text();d("input[name=name]").val(i),1===a?(d(".key_word_view").text(""),d(".content").hide(),d(".content_1").show()):5===a?(d(".right_content").hide(),d(e).parent().append(addChildAdd())):d(".right_content").hide(),click_menu=d(e).parents(".main_menu")}else if("pre_menu_item main_menu"===n){var r=d(d(".main_menu")[0]).find(".child_menu").length;r>0?d(".right_content").hide():t(d(".main_menu")[0]);var s=d(e).parent().find(".main_menu").length;1===s?(d(".right_top").hide(),d(".right_text").hide(),d(".main_menu,.add_add").css("width","100%"),d(".bottom").hide()):2===s?(d(d(".main_menu")[0]).find(".a_menu").css("border","1px solid "+a_color).css("color",a_color),d(d(".main_menu")[0]).find(".sub_pre_menu_box").show(),d(".main_menu,.add_add").css("width","50%")):3===s&&(d(".pre_menu_list").append(addAdd()),d(d(".main_menu")[0]).find(".a_menu").css("border","1px solid "+a_color).css("color",a_color),d(d(".main_menu")[0]).find(".sub_pre_menu_box").show(),d(".main_menu,.add_add").css("width","33.333%"))}d(e).remove()}),s.on("submit(sub)",function(){a(1);var e=[],n=1;if(d(".main_menu").each(function(a,t){var i={},r=JSON.parse(d(d(t).find(".save_value")[0]).text()),s=d(t).find(".child_menu").length;if(i.name=r.name,s>0){var u=[];if(d(t).find(".child_menu").each(function(e,a){var t={},r=JSON.parse(d(d(a).find(".save_value")[0]).text());if(t.name=r.name,"1"==r.menu_content)t.type="click",t.key=r.key;else if("2"==r.menu_content)t.type="view",t.url=r.url;else if("3"==r.menu_content){t.type="miniprogram",t.appid=r.AppID;var s=r.page_path.split("/#/");if("2"!=s.length)return layer.msg("小程序的页面参数错误"),n=0,!1;t.url=s[0],t.pagepath=s[1]}u.push(t),i.sub_button=u}),!n)return!1}else if("1"==r.menu_content)i.type="click",i.key=r.key;else if("2"==r.menu_content)i.type="view",i.url=r.url;else if("3"==r.menu_content){i.type="miniprogram",i.appid=r.AppID;var l=r.page_path.split("/#/");if("2"!=l.length)return layer.msg("小程序的页面参数错误"),n=0,!1;i.url=l[0],i.pagepath=l[1]}e.push(i)}),!n)return!1;var t={button:e};console.log(t),d.ajax({url:y,type:"post",async:!1,data:t,headers:p,beforeSend:function(){r=layer.load(h,f)},success:function(e){return layer.close(r),e.status==_?(layer.msg(c),u.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void layer.msg("菜单修改成功")},error:function(){layer.msg(m),layer.close(r)}})}),d(document).off("click",".show_key_word_list").on("click",".show_key_word_list",function(){d(".key_word_list").empty(),d.ajax({url:o+"/merchantWechatWords"+g+"&auto_type=3",type:"get",async:!1,headers:p,beforeSend:function(){r=layer.load(h,f)},success:function(e){if(layer.close(r),e.status==_)return layer.msg(c),u.exit(),!1;if(200!=e.status)return layer.msg(e.message),!1;console.log(e);var n=e.data,a=n.length;if("0"==a)return void layer.msg("请先设置关键词");for(var t=0;t<a;t++){var s=n[t].words;d(".key_word_list").append(addKeyWordList(s))}i=layer.open({type:1,title:"新增",content:d(".key_word_list"),shade:0,offset:"100px",area:["400px","auto"],cancel:function(){d(".key_word_list").hide()}})},error:function(){layer.msg(m),layer.close(r)}})}),d(document).on("click",".choose_top",function(){var e=d(this).find("input[name=key_word_id]").val(),n=d(this).find("span[class=key_word_name]").text();layer.close(i),d(".key_word_list").hide(),d("input[name=save_key_word_id]").val(e),d(".key_word_view").text(n)})}),e("wechat/menu",{})});var srcdiv=null,temp=null,srcdivChild=null,tempChild=null;