/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;function addImg(e,t){return'<div class="layui-col-md2 choose_top">\n<input class="checkbox The_selected" type="checkbox" name="del_img" value="'+e+'" style="display: none;">\n<img class="selected_img" style="" src="'+t+'" />\n</div>'}layui.define(function(e){layui.use(["table","jquery","form","admin","setter","element","laypage"],function(){function e(){A=d.render({elem:"#pageTable",url:W+I,where:{auto_type:3},page:!0,limit:T,limits:j,loading:!0,cols:[[{field:"words",title:"关键词",width:"15%"},{field:"reply_type",title:"回复类型",templet:"#replyTypeTpl",width:"10%"},{field:"content",title:"回复内容",width:"20%"},{field:"type",title:"匹配类型",templet:"#typeTpl",width:"10%"},{field:"status",title:"状态",width:"10%",templet:"#statusTpl"},{field:"create_time",title:"创建时间",width:"15%"},{field:"operations",title:"操作",toolbar:"#operations",width:"20%"}]],response:{statusName:"status",statusCode:"200",dataName:"data"},headers:k,done:function(e){return e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void 0}})}function t(e){c.ajax({url:p+"/merchantWechatMedia?type=image&page="+e,type:"get",async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(e){if(layer.close(l),e.status==w)return layer.msg(v),y.exit(),!1;if(200!=e.status)return layer.msg(e.message),!1;O=e.data.total_count;var t=e.data.item,a=t.length;if(a>0){c(".images").empty();for(var s=0;s<a;s++)c(".images").append(addImg(t[s].media_id,t[s].url))}c(".page1").show(),c(".page2").hide()},error:function(){layer.msg(h),layer.close(l)}})}function a(t){q="",U="",c(".image_url").attr("src",""),"1"==t?(c("#key_word_form")[0].reset(),e()):"2"==t?(c("#un_key_word_form")[0].reset(),c.ajax({url:M+"/2"+I,type:"get",async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(e){return layer.close(l),e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.close(s),void(e.data?(C="put",c("select[name=un_key_reply_type]").val(e.data.reply_type),"1"==e.data.reply_type?(c("input[name=un_key_content]").val(e.data.content),c(".show_content").show(),c(".show_image").hide()):(q=e.data.media_id,U=e.data.meida_url,c(".image_url").attr("src",U),c(".show_content").hide(),c(".show_image").show())):C="post"))},error:function(){layer.msg(h),layer.close(l)}})):"3"==t&&(c("#follow_form")[0].reset(),c.ajax({url:M+"/1"+I,type:"get",async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(e){return layer.close(l),e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.close(s),void(e.data?(C="put",c("select[name=follow_reply_type]").val(e.data.reply_type),"1"==e.data.reply_type?(c("input[name=follow_content]").val(e.data.content),c(".show_content").show(),c(".show_image").hide()):(q=e.data.media_id,U=e.data.meida_url,c(".image_url").attr("src",U),c(".show_content").hide(),c(".show_image").show())):C="post"))},error:function(){layer.msg(h),layer.close(l)}}))}var s,r,l,o,n,i,d=layui.table,c=layui.$,u=layui.form,y=layui.admin,m=layui.setter,p=m.baseUrl,_=layui.element,f=layui.laypage,g=m.successMsg,h=m.errorMsg,w=m.timeOutCode,v=m.timeOutMsg,k={"Access-Token":layui.data(m.tableName).access_token},b=1,x={shade:.3},T=10,j=[10,20,30],S=sessionStorage.getItem("saa_key");u.render();var A,W=p+"/merchantWechatWords",M=p+"/merchantWechatWord",I="?key="+S,N="",C="post";e(),u.on("submit(showAdd)",function(){c("#key_word_form")[0].reset(),c("input[name='add_edit_status']").prop("checked",!0),i="post",s=layer.open({type:1,title:"新增",content:c("#key_word_form"),shade:0,offset:"100px",area:["400px","auto"]})});var O=0,q="",U="";u.on("select(reply_type)",function(e){var t=e.value;"1"==t?(c(".show_content").show(),c(".show_image").hide(),q="",U=""):"2"==t&&(c(".show_content").hide(),c(".show_image").show(),c("input[name=content]").val(""))}),t(1),c(document).off("click",".key_word_select_pictures").on("click",".key_word_select_pictures",function(){r=layer.open({type:1,title:"选择图片",content:c(".select_pictures_page"),shade:0,offset:"100px",area:["80vw","40vw"]})}),f.render({elem:"image_page",count:O,limit:T,limits:j,jump:function(e,a){a||t(e.curr)}}),c(document).on("click",".choose_top",function(){q=c(c(this).find(".checkbox"))[0].value,U=c(c(this).find(".selected_img")[0]).attr("src"),layer.close(r),c(".image_url").attr("src",U)}),u.on("submit(key_word_sub)",function(){var e,t=0,a=W;c("input[name=add_edit_status]:checked").val()&&(t=1),"post"==i?o=g.post:"put"==i&&(a=W+"/"+n,o=g.put);var r=c("select[name=reply_type]").val(),d=c("input[name=content]").val();if(e={words:c("input[name=words]").val(),type:c("select[name=type]").val(),reply_type:r,auto_type:3,status:t,key:S},"1"==r){if(""==Trim(d))return void layer.msg("请填写回复内容");e.content=d}else if("2"==r){if(""==Trim(q))return void layer.msg("请选择回复图片");e.media_id=q,e.meida_url=U}c.ajax({url:a,data:e,type:i,async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(e){return layer.close(l),e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.msg(o),layer.close(s),c("#key_word_form")[0].reset(),void A.reload())},error:function(){layer.msg(h),layer.close(l)}})}),d.on("tool(pageTable)",function(e){var t=e.data,a=e.event;n=t.id,"edit"===a?(i="put",c.ajax({url:W+"/"+t.id+I,type:"get",async:!1,headers:k,success:function(e){return layer.close(l),e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(c("input[name=words]").val(e.data.words),c("select[name=type]").val(e.data.type),c("select[name=reply_type]").val(e.data.reply_type),"1"==e.data.reply_type?(c("input[name=content]").val(e.data.content),c(".show_content").show(),c(".show_image").hide()):(q=e.data.media_id,U=e.data.meida_url,c(".image_url").attr("src",U),c(".show_content").hide(),c(".show_image").show()),1==e.data.status?c("input[name=add_edit_status]").prop("checked",!0):c("input[name=add_edit_status]").removeAttr("checked"),u.render(),void(s=layer.open({type:1,title:"编辑",content:c("#key_word_form"),shade:0,offset:"100px",area:["400px","auto"]})))},error:function(){layer.msg(h),layer.close(l)},beforeSend:function(){l=layer.load(b,x)}})):"del"===a?layer.confirm("确定要删除这条数据么?",function(a){layer.close(a),c.ajax({url:W+"/"+t.id,data:{key:S},type:"delete",async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(t){return layer.close(l),t.status==w?(layer.msg(v),y.exit(),!1):200!=t.status?(layer.msg(t.message),!1):(layer.msg(g["delete"]),void e.del())},error:function(){layer.msg(h),layer.close(l)}})}):layer.msg(h)}),u.on("submit(un_key_word_sub)",function(){var e=c("select[name=un_key_reply_type]").val(),t=c("input[name=un_key_content]").val(),a={reply_type:e,auto_type:2,key:S};if("1"==e){if(""==Trim(t))return void layer.msg("请填写回复内容");a.content=t}else if("2"==e){if(""==Trim(q))return void layer.msg("请选择回复图片");a.media_id=q,a.meida_url=U}console.log(a),c.ajax({url:M,data:a,type:C,async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(e){return layer.close(l),e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.msg("请求成功"),void layer.close(s))},error:function(){layer.msg(h),layer.close(l)}})}),u.on("submit(follow_sub)",function(){var e=c("select[name=follow_reply_type]").val(),t=c("input[name=follow_content]").val(),a={reply_type:e,auto_type:1,key:S};if("1"==e){if(""==Trim(t))return void layer.msg("请填写回复内容");a.content=t}else if("2"==e){if(""==Trim(q))return void layer.msg("请选择回复图片");a.media_id=q,a.meida_url=U}console.log(a),c.ajax({url:M,data:a,type:C,async:!1,headers:k,beforeSend:function(){l=layer.load(b,x)},success:function(e){return layer.close(l),e.status==w?(layer.msg(v),y.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.msg("请求成功"),void layer.close(s))},error:function(){layer.msg(h),layer.close(l)}})}),_.on("tab(tab)",function(){N=this.getAttribute("lay-id"),a(N),u.render()}),u.on("submit(find)",function(e){c(".layui-tab").find("li").each(function(){c(this).removeAttr("class"),N=this.getAttribute("lay-id"),N===e.field.status&&c(this).attr("class","layui-this")}),A.reload({where:{name:e.field.name},page:{curr:1}})})}),e("wechat/reply",{})});