/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(e){layui.use(["table","jquery","form","admin","setter"],function(){function e(e){i.ajax({url:c+"/merchantPost"+w,type:"get",headers:g,beforeSend:function(){t=layer.load(h,_)},success:function(a){if(layer.close(t),a.status==p)return layer.msg(f),o.exit(),!1;if(200!==a.status)return layer.msg(a.message),!1;for(var s=0;s<a.data.length;s++){var r=a.data[s].name,l=a.data[s].id;if(e){var n="";e==l&&(n=" selected "),i("select[name=unfixedSelects]").append("<option value="+l+n+">"+r+"</option>")}else i("select[name=unfixedSelects]").append("<option value="+l+">"+r+"</option>");d.render()}T=1},error:function(){layer.msg(y),layer.close(t)}})}var a,t,s,r,l,n=layui.table,i=layui.$,d=layui.form,o=layui.admin,u=layui.setter,c=u.baseUrl,m=u.successMsg,y=u.errorMsg,p=u.timeOutCode,f=u.timeOutMsg,g={"Access-Token":layui.data(u.tableName).access_token},h=1,_={shade:.3},v=10,x=[10,20,30],b=sessionStorage.getItem("saa_key"),k=c+"/merchantPost",w="?key="+b,S=[{field:"name",title:"应用名称",width:"10%"},{field:"category_id",title:"应用类目",width:"10%"},{field:"pic_url",title:"应用图片",templet:"#imgTpl",width:"6%"},{field:"detail_info",title:"详细说明",width:"39%"},{field:"type",title:"应用类型",width:"10%",templet:"#typeTpl"},{field:"status",title:"状态",width:"10%",templet:"#statusTpl"},{field:"operations",title:"操作",toolbar:"#operations",width:"15%"}],T=0,j="";i("#addImgPut").change(function(){var e=this.files[0];if(window.FileReader){var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(e){j=e.target.result,i("#image").attr("src",e.target.result)}}e=null}),d.on("submit(showAdd)",function(){if(i("#add_edit_form")[0].reset(),i("input[name='add_edit_status']").prop("checked",!0),i("input[name='app_id']:eq(0)").prop("checked",!0),d.render(),l="post",T){var t=document.getElementById("unfixedSelects");t.options[0].selected=!0}else e(0);a=layer.open({type:1,title:"新增",content:i("#add_edit_form"),shade:0,offset:"100px",area:["400px","auto"]})}),d.on("submit(sub)",function(){var e,n=0,d=k;i("input[name=add_edit_status]:checked").val()&&(n=1),"post"==l?s=m.post:"put"==l&&(d=k+"/"+r,s=m.put),e={name:i("input[name=name]").val(),category_id:i("select[name=category_name]").val(),pic_url:j,detail_info:i("textarea[name=detail_info]").val(),type:i("input[name=applicationType]:checked").val(),status:n,key:b},i.ajax({url:d,data:e,type:l,async:!1,headers:g,beforeSend:function(){t=layer.load(h,_)},success:function(e){return layer.close(t),e.status==p?(layer.msg(f),o.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.msg(s),layer.close(a),i("#add_edit_form")[0].reset(),void N.reload())},error:function(){layer.msg(y),layer.close(t)}})}),n.on("tool(pageTable)",function(s){var n=s.data,u=s.event;r=n.id,"edit"===u?(l="put",i.ajax({url:k+"/"+n.id+w,type:"get",async:!1,headers:g,success:function(s){return layer.close(t),s.status==p?(layer.msg(f),o.exit(),!1):200!=s.status?(layer.msg(s.message),!1):(i("input[name=name]").val(s.data.name),T?i("#category_name").val(s.data.category_id):e(s.data.category_id),i("#image").attr("src",c+"/"+s.data.pic_url),i("textarea[name=detail_info]").val(s.data.detail_info),i("select[name=rule_type]").val(s.data.rule_type),i("input[name='radios'][value='"+s.data.type+"']").prop("checked",!0),1==s.data.status?i("input[name=add_edit_status]").prop("checked",!0):i("input[name=add_edit_status]").removeAttr("checked"),d.render(),void(a=layer.open({type:1,title:"编辑",content:i("#add_edit_form"),shade:0,offset:"100px",area:["400px","auto"]})))},error:function(){layer.msg(y),layer.close(t)},beforeSend:function(){t=layer.load(h,_)}})):"del"===u?layer.confirm("确定要删除这条数据么?",function(e){layer.close(e),i.ajax({url:k+"/"+n.id,data:{key:b},type:"delete",async:!1,headers:g,beforeSend:function(){t=layer.load(h,_)},success:function(e){return layer.close(t),e.status==p?(layer.msg(f),o.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.msg(m["delete"]),void s.del())},error:function(){layer.msg(y),layer.close(t)}})}):layer.msg(y)});var N=n.render({elem:"#pageTable",url:k+w,page:!0,limit:v,limits:x,loading:!0,cols:[S],response:{statusName:"status",statusCode:"200",dataName:"data"},headers:g,done:function(e){return e.status==p?(layer.msg(f),o.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void 0}});d.on("submit(find)",function(e){N.reload({where:{searchName:e.field.searchName},page:{curr:1}})}),d.on("switch(statusTpl)",function(e){var s=e.elem.checked?1:0;i.ajax({url:k+"/"+this.value,type:"put",async:!1,data:{status:s,key:b},headers:g,success:function(e){return layer.close(t),e.status==p?(layer.msg(f),o.exit(),!1):200!=e.status?(layer.msg(e.message),!1):(layer.msg(m.put),void layer.close(a))},error:function(){layer.msg(y),layer.close(t)},beforeSend:function(){t=layer.load(h,_)}})})}),e("model",{})});