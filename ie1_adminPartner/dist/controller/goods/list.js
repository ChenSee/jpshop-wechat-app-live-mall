/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(e){layui.use(["table","jquery","form","admin","setter"],function(){var e,t,a,i,s=layui.table,l=layui.$,r=layui.form,o=layui.admin,d=layui.setter,n=d.baseUrl,u=d.successMsg,c=d.errorMsg,m=d.timeOutCode,f=d.timeOutMsg,g={"Access-Token":layui.data(d.tableName).access_token},y=1,h={shade:.3},p=10,w=[10,20,30],v=sessionStorage.getItem("saa_key"),_=n+"/merchantGoods",b="?key="+v,k=[{field:"pic_urls",title:"图片",templet:"#imgTpl",width:"6%"},{field:"name",title:"名称",width:"18%"},{field:"price",title:"价格",width:"10%"},{field:"price",title:"访问量",width:"10%"},{field:"price",title:"库存",width:"10%"},{field:"price",title:"总销量",width:"10%"},{field:"create_time",title:"创建时间",width:"10%"},{field:"sort",title:"序号",width:"10%"},{field:"is_top",title:"推荐",templet:"#is_topTpl",width:"6%"},{field:"operations",title:"操作",toolbar:"#operations",width:"10%"}],T="";l("#addImgPut").change(function(){var e=this.files[0];if(window.FileReader){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(e){T=e.target.result,l("#image").attr("src",e.target.result)}}e=null}),l(document).on("click",".showAdd",function(){sessionStorage.removeItem("goods_id"),location.hash="/goods/add"}),s.on("tool(pageTable)",function(e){var s=e.data,r=e.event;i=s.id,"edit"===r?(a="edit",sessionStorage.setItem("goods_id",s.id),location.hash="/goods/add"):"del"===r?layer.confirm("确定要删除这条数据么?",function(a){layer.close(a),l.ajax({url:_+"/"+s.id,data:{key:v},type:"delete",async:!1,headers:g,beforeSend:function(){t=layer.load(y,h)},success:function(a){return a.status==m?(layer.msg(f),o.exit(),!1):(layer.close(t),200!=a.status?(layer.msg(a.message),!1):(layer.msg(u["delete"]),void e.del()))},error:function(){layer.msg(c),layer.close(t)}})}):layer.msg(c)});var x=s.render({elem:"#pageTable",url:_+b,page:!0,limit:p,limits:w,loading:!0,cols:[k],response:{statusName:"status",statusCode:"200",dataName:"data"},headers:g,done:function(e){if(e.status==m)return layer.msg(f),o.exit(),!1;if(200!=e.status)return layer.msg(e.message),!1;for(var t=e.data.length,a=0;a<t;a++){var i=e.data[a].pic_urls;e.data[a].pic_urls=i.split(",")[0]}}});r.on("submit(find)",function(e){x.reload({where:{searchName:e.field.searchName},page:{curr:1}})}),r.on("switch(is_topTpl)",function(a){var i=a.elem.checked?1:0;l.ajax({url:n+"/merchantGood/"+this.value,type:"put",async:!1,data:{is_top:i,key:v},headers:g,success:function(a){return a.status==m?(layer.msg(f),o.exit(),!1):(layer.close(t),200!=a.status?(layer.msg(a.message),!1):(layer.msg(u.put),void layer.close(e)))},error:function(){layer.msg(c),layer.close(t)},beforeSend:function(){t=layer.load(y,h)}})})}),e("goods/list",{})});