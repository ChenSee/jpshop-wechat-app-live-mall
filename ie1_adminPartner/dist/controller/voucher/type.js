/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(e){layui.use(["table","jquery","form","admin","setter","laydate"],function(){var e,a,t,s=layui.table,n=layui.$,l=layui.form,i=layui.admin,d=layui.setter,r=layui.laydate,o=d.baseUrl,u=d.successMsg,c=d.errorMsg,m=d.timeOutCode,p=d.timeOutMsg,y={"Access-Token":layui.data(d.tableName).access_token},f=1,_={shade:.3},v=10,g=[10,20,30],h=sessionStorage.getItem("saa_key"),b=o+"/shopVouTypes",k="?key="+h,x=[{field:"name",title:"类型名称",width:"10%"},{field:"price",title:"面值",width:"10%"},{field:"full_price",title:"满减金额",width:"10%"},{field:"count",title:"已发放总量",width:"10%"},{field:"days",title:"有效期",width:"10%"},{field:"from_date",title:"开始时间",width:"10%"},{field:"to_date",title:"结束时间",width:"10%"},{field:"status",title:"状态",width:"10%",templet:"#statusTpl"},{field:"operations",title:"操作",toolbar:"#operations",width:"20%"}];r.render({elem:"#from_to_date",type:"date",range:!0,done:function(e){console.log(e)}}),l.on("submit(showAdd)",function(){n("#add_edit_form")[0].reset(),n("input[name='add_edit_status']").prop("checked",!0),l.render(),n("input[name=add_edit_type]").val("add"),e=layer.open({type:1,title:"新增",content:n("#add_edit_form"),shade:0,offset:"100px",area:["400px","auto"]})}),l.on("submit(sub)",function(){var s,l,d,r=n("input[name='add_edit_type']").val(),o=b;s=n("input[name=add_edit_status]:checked").val()?1:0,"add"==r?(d="post",t=u.post):"edit"==r&&(o=b+"/"+n("input[name='operationId']").val(),d="put",t=u.put);var v=n("input[name=from_to_date]").val();v=v.split(" - "),l={name:n("input[name=name]").val(),type:n("select[name=type]").val(),price:n("input[name=price]").val(),full_price:n("input[name=full_price]").val(),receive_count:n("input[name=receive_count]").val(),count:n("input[name=count]").val(),days:n("input[name=days]").val(),act_id:n("#act_id").val(),from_date:v[0],to_date:v[1],status:s,key:h},n.ajax({url:o,data:l,type:d,async:!1,headers:y,beforeSend:function(){a=layer.load(f,_)},success:function(s){return s.status==m?(layer.msg(p),i.exit(),!1):(layer.close(a),200!=s.status?(layer.msg(s.message),!1):(layer.msg(t),layer.close(e),n("#add_edit_form")[0].reset(),void w.reload()))},error:function(){layer.msg(c),layer.close(a)}})}),s.on("tool(pageTable)",function(t){var s=t.data,d=t.event;n("input[name='operationId']").val(s.id),"edit"===d?(n("input[name='add_edit_type']").val("edit"),n.ajax({url:b+"/"+s.id+k,type:"get",async:!1,headers:y,success:function(t){return t.status==m?(layer.msg(p),i.exit(),!1):(layer.close(a),200!=t.status?(layer.msg(t.message),!1):(n("input[name=name]").val(t.data.name),n("select[name=type]").val(t.data.type),n("input[name=price]").val(t.data.price),n("input[name=full_price]").val(t.data.full_price),n("input[name=receive_count]").val(t.data.receive_count),n("input[name=count]").val(t.data.count),n("input[name=days]").val(t.data.days),n("input[name=from_to_date]").val(t.data.from_date+" - "+t.data.to_date),1==t.data.status?n("input[name=add_edit_status]").prop("checked",!0):n("input[name=add_edit_status]").removeAttr("checked"),l.render(),void(e=layer.open({type:1,title:"编辑",content:n("#add_edit_form"),shade:0,offset:"100px",area:["400px","auto"]}))))},error:function(){layer.msg(c),layer.close(a)},beforeSend:function(){a=layer.load(f,_)}})):"del"===d?layer.confirm("确定要删除这条数据么?",function(e){layer.close(e),n.ajax({url:b+"/"+s.id,data:{key:h},type:"delete",async:!1,headers:y,beforeSend:function(){a=layer.load(f,_)},success:function(e){return e.status==m?(layer.msg(p),i.exit(),!1):(layer.close(a),200!=e.status?(layer.msg(e.message),!1):(layer.msg(u["delete"]),void t.del()))},error:function(){layer.msg(c),layer.close(a)}})}):layer.msg(c)});var w=s.render({elem:"#pageTable",url:b+k,page:!0,limit:v,limits:g,loading:!0,cols:[x],response:{statusName:"status",statusCode:"200",dataName:"data"},headers:y,done:function(e){return e.status==m?(layer.msg(p),i.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void 0}});l.on("submit(find)",function(e){var a=e.field.searchName;w.reload({where:{searchName:a},page:{curr:1}})}),l.on("switch(status)",function(t){var s;t.elem.checked?s=1:t.elem.checked||(s=0),n.ajax({url:b+"/"+this.value,type:"put",async:!1,data:{status:s,key:h},headers:y,success:function(t){return t.status==m?(layer.msg(p),i.exit(),!1):(layer.close(a),200!=t.status?(layer.msg(t.message),!1):(layer.msg(u.put),void layer.close(e)))},error:function(){layer.msg(c),layer.close(a)},beforeSend:function(){a=layer.load(f,_)}})})}),e("voucher/type",{})});