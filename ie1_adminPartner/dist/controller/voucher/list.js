/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(e){layui.use(["table","jquery","form","admin","setter"],function(){function e(e){d.ajax({url:o+"/shopVouTypes"+x+"&status=1",type:"get",headers:m,beforeSend:function(){a=layer.load(f,g)},success:function(t){if(t.status==y)return layer.msg(p),l.exit(),!1;if(layer.close(a),200!==t.status)return layer.msg(t.message),!1;for(var s=0;s<t.data.length;s++){var r=t.data[s].name,n=t.data[s].id;if(e){var o="";e==n&&(o=" selected "),d("select[name=type_id]").append("<option value="+n+o+">"+r+"</option>")}else d("select[name=type_id]").append("<option value="+n+">"+r+"</option>");i.render()}w=1},error:function(){layer.msg(c),layer.close(a)}})}var t,a,s,r=layui.table,d=layui.$,i=layui.form,l=layui.admin,n=layui.setter,o=n.baseUrl,u=n.successMsg,c=n.errorMsg,y=n.timeOutCode,p=n.timeOutMsg,m={"Access-Token":layui.data(n.tableName).access_token},f=1,g={shade:.3},_=10,h=[10,20,30],v=sessionStorage.getItem("saa_key"),k=o+"/shopVouchers",x="?key="+v,b=[{field:"cdkey",title:"抵用券码",width:"20%"},{field:"price",title:"面值",width:"10%"},{field:"full_price",title:"满减条件",width:"10%"},{field:"is_exchange",title:"是否兑换",width:"10%",templet:"#is_exchangeTpl"},{field:"is_used",title:"是否使用",width:"10%",templet:"#is_usedTpl"},{field:"end_time",title:"到期时间",width:"10%"},{field:"type_name",title:"代金券类型",width:"10%"},{field:"status",title:"状态",width:"10%",templet:"#statusTpl"},{field:"operations",title:"操作",toolbar:"#operations",width:"10%"}],w=0;i.on("submit(showAdd)",function(){if(d("#add_edit_form")[0].reset(),d("input[name='add_edit_status']").prop("checked",!0),i.render(),d("input[name=add_edit_type]").val("add"),w){var a=document.getElementById("type_id");a.options[0].selected=!0}else e(0);t=layer.open({type:1,title:"新增",content:d("#add_edit_form"),shade:0,offset:"100px",area:["400px","auto"]})}),i.on("submit(sub)",function(e){var r,i,n,o=d("input[name='add_edit_type']").val(),_=k;r=d("input[name=add_edit_status]:checked").val()?1:0,"add"==o?(n="post",s=u.post):"edit"==o&&(_=k+"/"+d("input[name='operationId']").val(),n="put",s=u.put),i={type_id:d("#type_id").val(),status:r,key:v},d.ajax({url:_,data:i,type:n,async:!1,headers:m,beforeSend:function(){a=layer.load(f,g)},success:function(e){return e.status==y?(layer.msg(p),l.exit(),!1):(layer.close(a),200!=e.status?(layer.msg(e.message),!1):(layer.msg(s),layer.close(t),d("#add_edit_form")[0].reset(),void T.reload()))},error:function(){layer.msg(c),layer.close(a)}})}),r.on("tool(pageTable)",function(s){var r=s.data,n=s.event;d("input[name='operationId']").val(r.cdkey),"edit"===n?(d("input[name='add_edit_type']").val("edit"),d.ajax({url:k+"/"+r.cdkey+x,type:"get",async:!1,headers:m,success:function(s){return s.status==y?(layer.msg(p),l.exit(),!1):(layer.close(a),200!=s.status?(layer.msg(s.message),!1):(w?d("#type_id").val(s.data.type_id):e(s.data.type_id),1==s.data.status?d("input[name=add_edit_status]").prop("checked",!0):d("input[name=add_edit_status]").removeAttr("checked"),i.render(),void(t=layer.open({type:1,title:"编辑",content:d("#add_edit_form"),shade:0,offset:"100px",area:["400px","auto"]}))))},error:function(){layer.msg(c),layer.close(a)},beforeSend:function(){a=layer.load(f,g)}})):"del"===n?layer.confirm("确定要删除这条数据么?",function(e){layer.close(e),d.ajax({url:k+"/"+r.cdkey,data:{key:v},type:"delete",async:!1,headers:m,beforeSend:function(){a=layer.load(f,g)},success:function(e){return e.status==y?(layer.msg(p),l.exit(),!1):(layer.close(a),200!=e.status?(layer.msg(e.message),!1):(layer.msg(u["delete"]),void s.del()))},error:function(){layer.msg(c),layer.close(a)}})}):layer.msg(c)});var T=r.render({elem:"#pageTable",url:k+x,page:!0,limit:_,limits:h,loading:!0,cols:[b],response:{statusName:"status",statusCode:"200",dataName:"data"},headers:m,done:function(e){return e.status==y?(layer.msg(p),l.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void 0}});i.on("submit(find)",function(e){var t=e.field.searchName;T.reload({where:{searchName:t},page:{curr:1}})}),i.on("switch(status)",function(e){var s;e.elem.checked?s=1:e.elem.checked||(s=0),d.ajax({url:k+"/"+this.value,type:"put",async:!1,data:{status:s,key:v},headers:m,success:function(e){return e.status==y?(layer.msg(p),l.exit(),!1):(layer.close(a),200!=e.status?(layer.msg(e.message),!1):(layer.msg(u.put),void layer.close(t)))},error:function(){layer.msg(c),layer.close(a)},beforeSend:function(){a=layer.load(f,g)}})})}),e("voucher/list",{})});