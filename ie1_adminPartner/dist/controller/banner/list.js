/** layuiAdmin.pro-v1.0.0-beta7 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(function(e){layui.use(["table","jquery","form","admin","setter"],function(){var e,a,t,s,r,l=layui.table,n=layui.$,i=layui.form,u=layui.admin,o=layui.setter,d=o.baseUrl,c=o.successMsg,m=o.errorMsg,y=o.timeOutCode,p=o.timeOutMsg,f={"Access-Token":layui.data(o.tableName).access_token},g=1,h={shade:.3},v=10,_=[10,20,30],b=sessionStorage.getItem("saa_key"),x=d+"/merchantBanner",k="?key="+b,w=[{field:"name",title:"横幅名称",width:"20%"},{field:"pic_url",title:"横幅图片",templet:"#imgTpl",width:"20%"},{field:"jump_url",title:"跳转链接",width:"20%"},{field:"type",title:"应用类型",width:"20%",templet:"#typeTpl"},{field:"operations",title:"操作",toolbar:"#operations",width:"20%"}],j="";n("#addImgPut").change(function(){var e=this.files[0];if(window.FileReader){var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(e){j=e.target.result,n("#image").attr("src",e.target.result)}}e=null}),i.on("submit(showAdd)",function(){n("#add_edit_form")[0].reset(),n("#image").attr("src",""),n("input[name='type']:eq(0)").prop("checked",!0),i.render(),r="post",e=layer.open({type:1,title:"新增",content:n("#add_edit_form"),shade:0,offset:"100px",area:["600px","auto"]})}),i.on("submit(sub)",function(){var l,i=x;"post"==r?t=c.post:"put"==r&&(i=x+"/"+s,t=c.put),l={name:n("input[name=name]").val(),pic_url:j,jump_url:n("input[name=jump_url]").val(),type:n("input[name=type]:checked").val(),status:1,key:b},n.ajax({url:i,data:l,type:r,async:!1,headers:f,beforeSend:function(){a=layer.load(g,h)},success:function(s){return s.status==y?(layer.msg(p),u.exit(),!1):(layer.close(a),200!=s.status?(layer.msg(s.message),!1):(layer.msg(t),layer.close(e),n("#add_edit_form")[0].reset(),void T.reload()))},error:function(){layer.msg(m),layer.close(a)}})}),l.on("tool(pageTable)",function(t){var l=t.data,o=t.event;s=l.id,"edit"===o?(r="put",n.ajax({url:x+"/"+l.id+k,type:"get",async:!1,headers:f,success:function(t){return t.status==y?(layer.msg(p),u.exit(),!1):(layer.close(a),200!=t.status?(layer.msg(t.message),!1):(n("input[name=name]").val(t.data.name),n("#image").attr("src",t.data.pic_url),n("input[name=jump_url]").val(t.data.jump_url),n("input[name='type'][value='"+t.data.type+"']").prop("checked",!0),i.render(),void(e=layer.open({type:1,title:"编辑",content:n("#add_edit_form"),shade:0,offset:"100px",area:["600px","auto"]}))))},error:function(){layer.msg(m),layer.close(a)},beforeSend:function(){a=layer.load(g,h)}})):"del"===o?layer.confirm("确定要删除这条数据么?",function(e){layer.close(e),n.ajax({url:x+"/"+l.id,data:{key:b},type:"delete",async:!1,headers:f,beforeSend:function(){a=layer.load(g,h)},success:function(e){return e.status==y?(layer.msg(p),u.exit(),!1):(layer.close(a),200!=e.status?(layer.msg(e.message),!1):(layer.msg(c["delete"]),void t.del()))},error:function(){layer.msg(m),layer.close(a)}})}):layer.msg(m)});var T=l.render({elem:"#pageTable",url:x+k,page:!0,limit:v,limits:_,loading:!0,cols:[w],response:{statusName:"status",statusCode:"200",dataName:"data"},headers:f,done:function(e){return e.status==y?(layer.msg(p),u.exit(),!1):200!=e.status?(layer.msg(e.message),!1):void 0}});i.on("submit(find)",function(e){T.reload({where:{searchName:e.field.searchName},page:{curr:1}})}),i.on("switch(statusTpl)",function(t){var s=t.elem.checked?1:0;n.ajax({url:x+"/"+this.value,type:"put",async:!1,data:{status:s,key:b},headers:f,success:function(t){return t.status==y?(layer.msg(p),u.exit(),!1):(layer.close(a),200!=t.status?(layer.msg(t.message),!1):(layer.msg(c.put),void layer.close(e)))},error:function(){layer.msg(m),layer.close(a)},beforeSend:function(){a=layer.load(g,h)}})})}),e("banner/list",{})});